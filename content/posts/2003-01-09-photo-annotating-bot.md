---
title: Photo-annotating bot
author: Matt Biddulph
type: post
date: 2003-01-09T13:02:47+00:00
excerpt: \n
url: /2003/01/09/photo-annotating-bot/
categories:
  - bots
  - java
  - photos
  - rdf
  - rest

---
A background project for a while has been to write a bot to help me annotate the fairly large number of pictures I post to [picdiary][1] (1496 at the last count). Creating a document of [RSS-based metadata][2] is a slightly cumbersome text-editor job every time I post a new set of pics.

<!--more-->

  
After much thought, coding and discussion over the summer with [#bots][3] people, I came to the conclusion that a good architectural style for bots is, as [jo puts it][4], &#8220;a stateful conversational interface to an aspect of the semantic web&#8221;. Querying and updating information is modeled by HTTP GET and POST respectively. The code is structured after the Model-View-Controller pattern commonly used in GUI development: the View is a represention over IRC or another messaging system, the Controller responds to messages generated by running a [grammar-based parser][5] over the user&#8217;s input, and the Model lives on the web. The bot only keeps state relevant to the conversation (e.g. which picture we are currently talking about).

To get the bot up and running, I started by creating a GET-able query system based on [jena][6]. It has a nice RDF query language that&#8217;s somewhat SQLish, and can use berkeleydb and rdbms backends. I modeled [a store of queries][7] in RDF and wrote a java servlet to run queries and return results in [naive XML][8] or [RDF][9] formats.

With this flexible backend, I was able to write a commandline version of a bot using simple HTTP requests and the [Jakarta Digester][10] to extract information from the XML. Adding a new feature is mostly a case of augmenting the parser&#8217;s grammar and adding a new query to the query store.

Here&#8217;s a sample session with the commandline version of the bot:

<pre>> find mailto:jo@abduction.org
mailto:jo@abduction.org depicted in https://www.picdiary.com/xcom/IMG_1676.jpg
> read xcom
0: https://www.picdiary.com/xcom/IMG_1674.jpg
1: https://www.picdiary.com/xcom/IMG_1676.jpg
2: https://www.picdiary.com/xcom/IMG_1677.jpg
3: https://www.picdiary.com/xcom/IMG_1678.jpg
> current file
xcom
> use 0
Using pic with uri https://www.picdiary.com/xcom/IMG_1674.jpg
> current pic
https://www.picdiary.com/xcom/IMG_1674.jpg
> depicts
mailto:edd@usefulinc.com
mailto:ben@hammersley.com
> use 1
Using pic with uri https://www.picdiary.com/xcom/IMG_1676.jpg
> depicts
mailto:jo@abduction.org
</pre>

The next step is to extend the query system to allow updates and creates, and I&#8217;ll be nearly done.

 [1]: https://www.picdiary.com/cgi-bin/frontpage.pl
 [2]: https://www.picdiary.com/rss/highwalk.rss
 [3]: https://husk.org/bots/
 [4]: https://space.frot.org/techdetails.html
 [5]: https://www.webgain.com/products/java_cc/
 [6]: https://www.hpl.hp.com/semweb/jena-top.html
 [7]: https://www.picdiary.com/~mattb/queries.rdf
 [8]: https://www.picdiary.com:8180/rss/query/depicts?mbox=mailto:edd@usefulinc.com
 [9]: https://www.picdiary.com:8180/rss/query/depicts?mbox=mailto:edd@usefulinc.com&rdf=1
 [10]: https://jakarta.apache.org/commons/digester/